<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ibsMybatis.ibsUserApiQuery">
	<select id="userLayoutList" parameterType="java.util.Map" resultType="hanibal.ibs.model.cms.BoardDTO">
		select
				(a.idx) as idx,
			    (select category_name from tb_board_category where idx=a.category_idx) as category_idx,
			    (select main_thumbnail from tb_vod_repository where idx=a.vod_repo) as vod_repo,
			    (a.photo_repo) as photo_repo,
			    (a.file_repo) as file_repo,
			    (a.live_repo) as live_repo,
			    (a.board_title) as board_title,
			    (a.board_content) as board_content,
			    (a.board_keyword) as board_keyword,
			    (date_format(a.reg_dt,'%Y .%m. %d')) as reg_dt,
			    (a.reg_id) as reg_id,
			    (a.reg_ip) as reg_ip,
			    (a.del_flag) as del_flag,
			    date_format(a.edit_dt,'%Y년 %m월 %d일') as edit_dt,
			    (a.favorite_count) as favorite_count,
			    (a.view_count) as view_count
			from tb_board_repository a  where 1=1 
			<if test='wl_attribute=="B"'>
			and <![CDATA[LENGTH(concat(photo_repo,file_repo))>1]]>
			</if>
			<if test='searchWord!=""'>
		  and (board_title like concat('%',#{searchWord},'%')
		  or board_content like concat('%',#{searchWord},'%') 
		  or board_keyword like concat('%',#{searchWord},'%') 
		  or (select category_name from tb_board_category where idx=a.category_idx) like concat('%',#{searchWord},'%')) 
		  </if>
		  and del_flag='N'
		  	<if test='eachFlag!=""'>
	  			and category_idx in
	  			<foreach collection="childIdxArr" item="type" index="index"  open="(" close=")" separator=",">
         			#{type}
      			</foreach>
      		</if>
      		order by 
      		<if test='wl_sort=="R"'>
      		a.reg_dt desc limit #{start},#{end};
      		</if>
      		<if test='wl_sort=="F"'>
      		a.view_count desc limit #{start},#{end};
      		</if>
	</select>
</mapper> 

